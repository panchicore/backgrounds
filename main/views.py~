from django.template.context import RequestContext
from django.http import HttpResponse
from django.shortcuts import render_to_response
import simplejson
import urllib2
# Create your views here.

def map(request):
    return render_to_response('map.html', {}, context_instance=RequestContext(request))

def get_panoramio_pics(request):
    first = 0
    last = 50
    minx = request.GET.get('minx')
    miny = request.GET.get('miny')
    maxx = request.GET.get('maxx')
    maxy = request.GET.get('maxy')
    panoramio_url = "http://www.panoramio.com/map/get_panoramas.php?set=public&from=%i&to=%i&minx=%s&miny=%s&maxx=%s&maxy=%s&size=thumbnail"
    #panoramio_url = panoramio_url % (first, last,  -74.9, 10.8,  -74.6, 11.0)
    panoramio_url = panoramio_url % (first, last,  minx, miny, maxx, maxy)
    print panoramio_url
    req = urllib2.Request(panoramio_url)
    opener = urllib2.build_opener()
    f = opener.open(req)
    json = simplejson.load(f)
    print json
    photos = json.get('photos')
    response = ''
    for p in photos:
        tag = '<img src="%s" title="%s">' % ( p.get('photo_file_url'),p.get('photo_title'))
        response = response + tag
    return HttpResponse(response)